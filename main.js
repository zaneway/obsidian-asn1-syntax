/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.create;var N=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var L=h=>N(h,"__esModule",{value:!0});var x=(h,e)=>{L(h);for(var t in e)N(h,t,{get:e[t],enumerable:!0})},$=(h,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of F(e))!D.call(h,n)&&n!=="default"&&N(h,n,{get:()=>e[n],enumerable:!(t=v(e,n))||t.enumerable});return h},B=h=>$(L(N(h!=null?I(O(h)):{},"default",h&&h.__esModule&&"default"in h?{get:()=>h.default,enumerable:!0}:{value:h,enumerable:!0})),h);x(exports,{default:()=>A});var p=B(require("obsidian")),C={settingsTitle:"ASN.1 \u8BED\u6CD5\u8BBE\u7F6E",indentSize:"\u7F29\u8FDB\u5927\u5C0F",indentSizeDesc:"\u6BCF\u4E2A\u7F29\u8FDB\u7EA7\u522B\u4F7F\u7528\u7684\u7A7A\u683C\u6570",formatOnSave:"\u4FDD\u5B58\u65F6\u683C\u5F0F\u5316",formatOnSaveDesc:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801\u5757",maxLineLength:"\u6700\u5927\u884C\u957F\u5EA6",maxLineLengthDesc:"\u6362\u884C\u524D\u7684\u6700\u5927\u884C\u957F\u5EA6\uFF0840-120 \u5B57\u7B26\uFF09",autoWrapLongLines:"\u81EA\u52A8\u6362\u884C\u957F\u884C",autoWrapLongLinesDesc:"\u683C\u5F0F\u5316\u65F6\u81EA\u52A8\u6362\u884C\u957F\u884C",autoFormatting:"\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnExit:"\u79BB\u5F00\u65F6\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnExitDesc:"\u79BB\u5F00\u4EE3\u7801\u5757\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801",autoFormatOnEnter:"\u6309Enter\u65F6\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnEnterDesc:"\u5728\u4EE3\u7801\u5757\u4E2D\u6309Enter\u952E\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801",customKeywords:"\u81EA\u5B9A\u4E49\u5173\u952E\u5B57",customBasicTypes:"\u81EA\u5B9A\u4E49\u57FA\u672C\u7C7B\u578B",customBasicTypesDesc:'\u6DFB\u52A0\u7528\u4E8E\u8BED\u6CD5\u9AD8\u4EAE\u7684\u81EA\u5B9A\u4E49\u57FA\u672C\u7C7B\u578B\uFF08\u9017\u53F7\u5206\u9694\uFF0C\u4F8B\u5982\uFF1A"MyType, CustomString, SpecialInt"\uFF09',colorSettings:"\u989C\u8272\u8BBE\u7F6E",lightThemeColors:"\u4EAE\u8272\u4E3B\u9898\u989C\u8272",darkThemeColors:"\u6697\u8272\u4E3B\u9898\u989C\u8272",resetColors:"\u91CD\u7F6E\u989C\u8272",resetColorsDesc:"\u5C06\u6240\u6709\u989C\u8272\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",resetToDefaults:"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",keywords:"\u5173\u952E\u5B57",strings:"\u5B57\u7B26\u4E32",comments:"\u6CE8\u91CA",numbers:"\u6570\u5B57",punctuation:"\u6807\u70B9\u7B26\u53F7",variables:"\u53D8\u91CF",objectIdentifiers:"\u5BF9\u8C61\u6807\u8BC6\u7B26",tags:"\u6807\u7B7E",operators:"\u64CD\u4F5C\u7B26",customKeywordsColor:"\u81EA\u5B9A\u4E49\u5173\u952E\u5B57",formatASN1:"\u683C\u5F0F\u5316 ASN.1",autoFormatASN1:"\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1\uFF08\u5B9E\u65F6\uFF09",testASN1AutoFormat:"\u6D4B\u8BD5 ASN.1 \u81EA\u52A8\u683C\u5F0F\u5316\uFF08\u5F53\u524D\u5757\uFF09"},k={settingsTitle:"ASN.1 Syntax Settings",indentSize:"Indent Size",indentSizeDesc:"Number of spaces to use for each indentation level",formatOnSave:"Format on Save",formatOnSaveDesc:"Automatically format ASN.1 code blocks when saving",maxLineLength:"Max Line Length",maxLineLengthDesc:"Maximum line length before wrapping (40-120 characters)",autoWrapLongLines:"Auto Wrap Long Lines",autoWrapLongLinesDesc:"Automatically wrap long lines during formatting",autoFormatting:"Auto Formatting",autoFormatOnExit:"Auto Format on Exit",autoFormatOnExitDesc:"Automatically format ASN.1 code when leaving the code block",autoFormatOnEnter:"Auto Format on Enter",autoFormatOnEnterDesc:"Automatically format ASN.1 code when pressing Enter key in code block",customKeywords:"Custom Keywords",customBasicTypes:"Custom Basic Types",customBasicTypesDesc:'Add custom basic types for syntax highlighting (comma-separated, e.g., "MyType, CustomString, SpecialInt")',colorSettings:"Color Settings",lightThemeColors:"Light Theme Colors",darkThemeColors:"Dark Theme Colors",resetColors:"Reset Colors",resetColorsDesc:"Reset all colors to default values",resetToDefaults:"Reset to Defaults",keywords:"Keywords",strings:"Strings",comments:"Comments",numbers:"Numbers",punctuation:"Punctuation",variables:"Variables",objectIdentifiers:"Object Identifiers",tags:"Tags",operators:"Operators",customKeywordsColor:"Custom Keywords",formatASN1:"Format ASN.1",autoFormatASN1:"Auto Format ASN.1 (Real-time)",testASN1AutoFormat:"Test ASN.1 Auto Format (Current Block)"},b=class{constructor(e){this.currentLanguage="zh-CN";this.strings=C;this.detectLanguage(e)}detectLanguage(e){var n,s,o;let t=((s=(n=e.vault)==null?void 0:n.config)==null?void 0:s.locale)||((o=e.settings)==null?void 0:o.locale)||navigator.language||"zh-CN";console.log("Detected Obsidian locale:",t),t.startsWith("zh")?(this.currentLanguage="zh-CN",this.strings=C):(this.currentLanguage="en-US",this.strings=k),console.log("Using language:",this.currentLanguage)}t(e){return this.strings[e]||e}getCurrentLanguage(){return this.currentLanguage}setLanguage(e){e==="zh-CN"?(this.currentLanguage="zh-CN",this.strings=C):(this.currentLanguage="en-US",this.strings=k)}},y={indentSize:2,formatOnSave:!0,maxLineLength:80,autoWrapLongLines:!0,autoFormatOnExit:!0,autoFormatOnEnter:!0,customKeywords:"",colors:{keyword:"#07a",string:"#690",comment:"#999",number:"#905",punctuation:"#999",variable:"#DD4A68",oid:"#8E44AD",tag:"#E67E22",operator:"#2C3E50",customKeyword:"#07a"},darkColors:{keyword:"#c678dd",string:"#98c379",comment:"#5c6370",number:"#d19a66",punctuation:"#abb2bf",variable:"#e06c75",oid:"#BB86FC",tag:"#F39C12",operator:"#56B6C2",customKeyword:"#c678dd"}},A=class extends p.Plugin{constructor(){super(...arguments);this.formattingInProgress=!1}async onload(){try{console.log("Loading ASN.1 plugin"),this.i18n=new b(this.app),await this.loadSettings(),this.registerASN1Mode(),this.registerMarkdownCodeBlockProcessor("asn1",(e,t,n)=>{try{let s=document.createElement("pre"),o=document.createElement("code");o.className="language-asn1",o.textContent=e,s.appendChild(o),t.appendChild(s),this.highlightASN1(o)}catch(s){console.error("Error in ASN.1 code block processor:",s)}}),this.addCommand({id:"format-asn1",name:this.i18n.t("formatASN1"),editorCallback:e=>{try{this.formatASN1(e)}catch(t){console.error("Error in format command:",t)}}}),this.addCommand({id:"auto-format-asn1",name:this.i18n.t("autoFormatASN1"),editorCallback:e=>{try{this.toggleAutoFormatting(e)}catch(t){console.error("Error in auto format command:",t)}}}),this.addCommand({id:"test-asn1-auto-format",name:this.i18n.t("testASN1AutoFormat"),editorCallback:e=>{try{this.isASN1CodeBlock(e)?(this.autoFormatCurrentBlock(e),console.log("Auto format test executed")):console.log("Not in ASN.1 code block")}catch(t){console.error("Error in test command:",t)}}}),this.addSettingTab(new w(this.app,this)),this.applyCustomColors(),this.setupGlobalAutoFormatting(),console.log("ASN.1 plugin loaded successfully")}catch(e){throw console.error("Error loading ASN.1 plugin:",e),e}}setupAutoFormatting(e){var a;if(!this.settings.formatOnSave&&!this.settings.autoFormatOnExit&&!this.settings.autoFormatOnEnter)return;let t=!1,n=null,s=this.app.workspace.on("editor-change",c=>{if(!this.formattingInProgress&&(console.log("Editor change detected"),c===e)){console.log("Change in target editor"),n&&(clearTimeout(n),n=null);let l=this.isASN1CodeBlock(c);if(this.settings.autoFormatOnExit&&t&&!l&&(console.log("Left ASN.1 code block, triggering format"),n=setTimeout(()=>{this.formatLastASN1Block(c)},300)),this.settings.formatOnSave&&l){let g=c.getCursor();if(g&&g.ch>0){let m=c.getLine(g.line).charAt(g.ch-1);console.log("Last character:",m),(m==="}"||m===";"||m===","||m===")"||m==="]")&&(console.log("Trigger character detected, scheduling format"),n=setTimeout(()=>{this.isASN1CodeBlock(c)&&this.autoFormatCurrentBlock(c)},200))}}t=l}}),o=c=>{this.formattingInProgress||(n&&(clearTimeout(n),n=null),this.settings.autoFormatOnEnter&&c.key==="Enter"&&!c.shiftKey&&!c.ctrlKey&&!c.altKey&&(console.log("Enter key pressed"),n=setTimeout(()=>{this.isASN1CodeBlock(e)&&(console.log("Formatting after Enter in ASN.1 block"),this.autoFormatCurrentBlock(e))},200)),this.settings.autoFormatOnExit&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(c.key)&&(n=setTimeout(()=>{let l=this.isASN1CodeBlock(e);t&&!l&&(console.log("Left ASN.1 code block via navigation, triggering format"),this.formatLastASN1Block(e)),t=l},500)))},i=c=>{this.formattingInProgress||!this.settings.autoFormatOnExit||(n&&(clearTimeout(n),n=null),n=setTimeout(()=>{let l=this.isASN1CodeBlock(e);t&&!l&&(console.log("Left ASN.1 code block via mouse click, triggering format"),this.formatLastASN1Block(e)),t=l},300))},r=e.containerEl||((a=e.cm)==null?void 0:a.getWrapperElement());r?(r.addEventListener("keydown",o),this.settings.autoFormatOnExit&&r.addEventListener("click",i),this.register(()=>{r.removeEventListener("keydown",o),r.removeEventListener("click",i),this.app.workspace.offref(s),n&&clearTimeout(n)})):this.register(()=>{this.app.workspace.offref(s),n&&clearTimeout(n)}),t=this.isASN1CodeBlock(e)}autoFormatCurrentBlock(e){try{if(console.log("autoFormatCurrentBlock called"),this.isASN1CodeBlock(e)){console.log("In ASN.1 code block, formatting...");let t=e.getCursor(),n=t.line,s=t.ch;this.formattingInProgress=!0,this.formatASN1(e),this.formattingInProgress=!1;try{let o=e.lineCount(),i=Math.min(n,o-1),r=e.getLine(i),a=Math.min(s,r.length);e.setCursor({line:i,ch:a}),console.log("Cursor position restored")}catch(o){console.warn("Could not restore cursor position:",o)}}else console.log("Not in ASN.1 code block")}catch(t){console.error("Error in autoFormatCurrentBlock:",t),this.formattingInProgress=!1}}formatLastASN1Block(e){try{console.log("formatLastASN1Block called");let t=e.getCursor(),n=e.lineCount();if(!t||n===0)return;let s=Math.max(0,t.line-50),o=Math.min(n-1,t.line+50);for(let i=s;i<=o;i++)try{let r=e.getLine(i);if(r&&r.trim().startsWith("``asn1")){let a=i+1;for(;a<n;){let c=e.getLine(a);if(c&&c.trim()==="```"){console.log(`Found ASN.1 block from line ${i} to ${a}, formatting...`),this.formatSpecificASN1Block(e,i,a);return}a++}}}catch(r){console.warn("Error reading line",i,":",r)}console.log("No ASN.1 block found near cursor position")}catch(t){console.error("Error in formatLastASN1Block:",t)}}formatSpecificASN1Block(e,t,n){try{console.log(`Formatting ASN.1 block from line ${t} to ${n}`);let s=[];for(let a=t+1;a<n;a++)try{s.push(e.getLine(a))}catch(c){console.warn("Error reading line",a,":",c),s.push("")}if(s.length===0){console.log("No content to format");return}let o=s.join(`
`);console.log("Original code to format:",o);let i=this.formatASN1Code(o);if(console.log("Formatted code result:",i),i===o){console.log("Code is already formatted");return}let r=e.getCursor();try{let a=i.endsWith(`
`)?i:i+`
`;e.replaceRange(a,{line:t+1,ch:0},{line:n,ch:0});let c=e.lineCount(),l=Math.min(r.line,c-1),g=e.getLine(l),u=Math.min(r.ch,g?g.length:0);e.setCursor({line:l,ch:u}),console.log("Specific ASN.1 block formatted successfully")}catch(a){console.error("Error replacing code content:",a)}}catch(s){console.error("Error in formatSpecificASN1Block:",s)}}isASN1CodeBlock(e){try{let t=e.getCursor(),n=e.lineCount();if(!t||n===0)return!1;let s=t.line,o=!1;for(;s>=0;){try{let a=e.getLine(s);if(a&&a.trim().startsWith("```asn1")){o=!0;break}if(a&&a.trim().startsWith("```")&&!a.trim().startsWith("```asn1"))return!1}catch(a){return console.warn("Error reading line",s,":",a),!1}s--}if(!o)return!1;let i=t.line,r=!1;for(;i<n;){try{let a=e.getLine(i);if(a&&a.trim()==="```"&&i>s){r=!0;break}}catch(a){return console.warn("Error reading line",i,":",a),!1}i++}return r&&t.line>s&&t.line<i}catch(t){return console.error("Error in isASN1CodeBlock:",t),!1}}toggleAutoFormatting(e){this.settings.formatOnSave?(this.settings.formatOnSave=!1,console.log("Auto formatting disabled")):(this.settings.formatOnSave=!0,console.log("Auto formatting enabled")),this.saveSettings()}applyCustomColors(){let e=document.getElementById("asn1-custom-colors");e&&e.remove();let t=document.createElement("style");t.id="asn1-custom-colors";let n=this.settings.colors,s=this.settings.darkColors;console.log("\u5E94\u7528\u81EA\u5B9A\u4E49\u989C\u8272\u8BBE\u7F6E:"),console.log("\u81EA\u5B9A\u4E49\u5173\u952E\u5B57\u989C\u8272 (\u4EAE\u8272):",n.customKeyword),console.log("\u81EA\u5B9A\u4E49\u5173\u952E\u5B57\u989C\u8272 (\u6697\u8272):",s.customKeyword),t.textContent=`
			/* ASN.1 \u81EA\u5B9A\u4E49\u989C\u8272 - \u4EAE\u8272\u4E3B\u9898 */
			.asn1-keyword { color: ${n.keyword} !important; }
			.asn1-string { color: ${n.string} !important; }
			.asn1-comment { color: ${n.comment} !important; }
			.asn1-number { color: ${n.number} !important; }
			.asn1-punctuation { color: ${n.punctuation} !important; }
			.asn1-variable { color: ${n.variable} !important; }
			.asn1-oid { color: ${n.oid} !important; }
			.asn1-tag { color: ${n.tag} !important; }
			.asn1-operator { color: ${n.operator} !important; }
			/* \u589E\u52A0CSS\u9009\u62E9\u5668\u4F18\u5148\u7EA7\uFF0C\u786E\u4FDD\u81EA\u5B9A\u4E49\u5173\u952E\u5B57\u989C\u8272\u6B63\u786E\u663E\u793A */
			code .asn1-custom-keyword, pre .asn1-custom-keyword, .asn1-custom-keyword { color: ${n.customKeyword} !important; }
			
			/* ASN.1 \u81EA\u5B9A\u4E49\u989C\u8272 - \u6697\u8272\u4E3B\u9898 */
			.theme-dark .asn1-keyword { color: ${s.keyword} !important; }
			.theme-dark .asn1-string { color: ${s.string} !important; }
			.theme-dark .asn1-comment { color: ${s.comment} !important; }
			.theme-dark .asn1-number { color: ${s.number} !important; }
			.theme-dark .asn1-punctuation { color: ${s.punctuation} !important; }
			.theme-dark .asn1-variable { color: ${s.variable} !important; }
			.theme-dark .asn1-oid { color: ${s.oid} !important; }
			.theme-dark .asn1-tag { color: ${s.tag} !important; }
			.theme-dark .asn1-operator { color: ${s.operator} !important; }
			/* \u589E\u52A0CSS\u9009\u62E9\u5668\u4F18\u5148\u7EA7\uFF0C\u786E\u4FDD\u6697\u8272\u4E3B\u9898\u4E0B\u81EA\u5B9A\u4E49\u5173\u952E\u5B57\u989C\u8272\u6B63\u786E\u663E\u793A */
			.theme-dark code .asn1-custom-keyword, .theme-dark pre .asn1-custom-keyword, .theme-dark .asn1-custom-keyword { color: ${s.customKeyword} !important; }
		`,document.head.appendChild(t),console.log("\u81EA\u5B9A\u4E49\u989C\u8272\u6837\u5F0F\u5DF2\u5E94\u7528")}onunload(){console.log("Unloading ASN.1 plugin");let e=document.getElementById("asn1-custom-colors");e&&e.remove()}registerASN1Mode(){try{console.log("ASN.1 syntax mode registered (simplified)")}catch(e){console.error("Error registering ASN.1 mode:",e)}}highlightASN1(e){try{let i=function(a){try{return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}catch(c){return console.warn("Error escaping HTML:",c),a}};if(!e){console.warn("Code element is null or undefined");return}let t=e.textContent||"";if(!t.trim()){console.warn("No code content to highlight");return}let n=["BOOLEAN","INTEGER","BIT","OCTET","NULL","OBJECT","REAL","ENUMERATED","EMBEDDED","UTF8String","RELATIVE-OID","NumericString","PrintableString","TeletexString","T61String","VideotexString","IA5String","GraphicString","VisibleString","GeneralString","UniversalString","BMPString","UTCTime","GeneralizedTime","SEQUENCE","SET","CHOICE","STRING","UNIVERSAL","APPLICATION","PRIVATE","CONTEXT","EXPLICIT","IMPLICIT","AUTOMATIC","TAGS","DEFINITIONS","BEGIN","END","EXPORTS","IMPORTS","FROM","SIZE","WITH","COMPONENT","COMPONENTS","PRESENT","ABSENT","OPTIONAL","DEFAULT","INCLUDES","PATTERN","UNION","INTERSECTION","EXCEPT","ALL","TRUE","FALSE","PLUS-INFINITY","MINUS-INFINITY","MIN","MAX","CLASS","TYPE-IDENTIFIER","ABSTRACT-SYNTAX","INSTANCE","SYNTAX","UNIQUE","CONSTRAINED","CHARACTER","PDV","EXTERNAL","BY","OF","IDENTIFIER"],s=this.settings.customKeywords.split(",").map(a=>a.trim()).filter(a=>a.length>0),o=[...n,...s],r=i(t);try{r=r.replace(/-\*[\s\S]*?\*-/g,'<span class="asn1-comment">$&</span>'),r=r.replace(/(?<!<[^>]*class="[^"]*)\b--.*$/gm,'<span class="asn1-comment">$&</span>'),r=r.replace(/"(?:[^"\\\\]|\\\\.)*"/g,'<span class="asn1-string">$&</span>'),r=r.replace(/\b\d+(?:\.\d+)?\b/g,'<span class="asn1-number">$&</span>'),r=r.replace(/\{[\d\s]+\}/g,'<span class="asn1-oid">$&</span>'),r=r.replace(/\[(?:UNIVERSAL|APPLICATION|PRIVATE|CONTEXT)?\s*\d+\](?:\s+(?:IMPLICIT|EXPLICIT))?/g,'<span class="asn1-tag">$&</span>'),r=r.replace(/::\s*=/g,'<span class="asn1-operator">$&</span>'),r=r.replace(/\.\.\./g,'<span class="asn1-operator">$&</span>');for(let a of s)try{let c=a.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),l=new RegExp(`\\b${c}\\b`,"gi");r=r.replace(l,'<span class="asn1-custom-keyword">$&</span>'),console.log(`Applied custom keyword highlighting for "${a}" with color: ${this.settings.colors.customKeyword}`)}catch(c){console.warn(`Error highlighting custom keyword "${a}":`,c)}for(let a of n)try{let c=a.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),l=new RegExp(`\\b${c}\\b`,"gi"),g="",u=0,m;for(l.lastIndex=0;(m=l.exec(r))!==null;){let d=m.index,f=d+m[0].length,S=!1,E=r.lastIndexOf("<span",d);if(E!==-1){let T=r.indexOf("</span>",E);T!==-1&&T>f&&(S=!0)}S||(g+=r.substring(u,d),g+=`<span class="asn1-keyword">${m[0]}</span>`,u=f)}g+=r.substring(u),r=g}catch(c){console.warn(`Error highlighting keyword "${a}":`,c)}e.innerHTML=r}catch(a){console.error("Error during syntax highlighting:",a),e.textContent=t}}catch(t){console.error("Error in highlightASN1:",t)}}formatASN1(e){try{console.log("formatASN1 started");let t=e.getCursor(),n=e.lineCount();if(!t||n===0){console.warn("Editor is empty or cursor not available");return}let s=t.line,o=t.line,i=!1;for(;s>=0;){try{let g=e.getLine(s);if(g&&g.trim().startsWith("```asn1")){i=!0;break}}catch(g){console.warn("Error reading line",s,":",g);break}s--}if(!i){console.warn("ASN.1 code block start not found");return}let r=!1;for(;o<n;){try{let g=e.getLine(o);if(g&&g.trim()==="```"&&o>s){r=!0;break}}catch(g){console.warn("Error reading line",o,":",g);break}o++}if(!r){console.warn("ASN.1 code block end not found");return}let a=[];for(let g=s+1;g<o;g++)try{a.push(e.getLine(g))}catch(u){console.warn("Error reading line",g,":",u),a.push("")}if(a.length===0){console.warn("No content to format");return}let c=a.join(`
`);console.log("Original code to format:",c);let l=this.formatASN1Code(c);if(console.log("Formatted code result:",l),l===c){console.log("Code is already formatted");return}try{let g=l.endsWith(`
`)?l:l+`
`;e.replaceRange(g,{line:s+1,ch:0},{line:o,ch:0}),console.log("Code formatted successfully")}catch(g){console.error("Error replacing code content:",g)}}catch(t){console.error("Error in formatASN1:",t)}}formatASN1Code(e){if(console.log("\u{1F527} Starting simplified ASN.1 format with code:",e),!e||!e.trim())return"";try{return this.simpleFormatASN1(e)}catch(t){return console.error("\u274C Error in ASN.1 formatting:",t),this.fallbackFormat(e)}}simpleFormatASN1(e){let t=e.trim();return t=t.replace(/\}\s*(\w+\s*::=)/g,`}


$1`),t=this.formatTypeDefinitionsWithNestedBraces(t),t=this.cleanupSpacing(t),console.log("\u2728 Simple formatted result:",t),t}formatTypeDefinitionsWithNestedBraces(e){let t=/(\w+\s*::=\s*(?:SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{)/g,n=e,s,o=[];for(;(s=t.exec(e))!==null;){let i=s.index,r=s[1],a=this.findMatchingBrace(e,i+r.length-1);a!==-1&&o.push({start:i,end:a,prefix:r})}for(let i=o.length-1;i>=0;i--){let{start:r,end:a,prefix:c}=o[i],l=e.substring(r,a+1),g=this.formatSingleTypeDefinition(l,c);n=n.substring(0,r)+g+n.substring(a+1)}return n}findMatchingBrace(e,t){let n=0,s=!1;for(let o=t;o<e.length;o++){let i=e[o],r=o>0?e[o-1]:"";if(i==='"'&&r!=="\\"&&(s=!s),!s){if(i==="{")n++;else if(i==="}"&&(n--,n===0))return o}}return-1}formatSingleTypeDefinition(e,t){let n=e.indexOf("{"),s=e.lastIndexOf("}");if(n===-1||s===-1)return e;let o=e.substring(n+1,s).trim();if(!o)return`${t.trimEnd()}
}`;let i=this.splitTopLevelByComma(o);if(i.length<=1){let c=this.normalizeFieldContent(o);return`${t.trimEnd()}
  ${c}
}`}let r="  ",a=[];a.push(t.trimEnd());for(let c=0;c<i.length;c++){let l=this.normalizeFieldContent(i[c]),g=c===i.length-1?"":",";a.push(r+l+g)}return a.push("}"),a.join(`
`)}cleanupSpacing(e){return e.replace(/\n{3,}/g,`


`).replace(/^\n+/,"").replace(/\n+$/,`
`)}ensureTwoBlankLinesBetweenTypeDefinitions(e){return e=e.replace(/\}\n+(?=\s*\w+\s*::=)/g,`}


`),e=e.replace(/(\w+\s*::=.*?[\s\S]*?)\n+(?=\s*\w+\s*::=)/g,(t,n)=>`${n}


`),e}postExpandInlineStructures(e){let t=/(\w+\s*::=\s*(?:SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{)([^}]*?)(\})/g;return e.replace(t,(n,s,o,i)=>{let r=this.splitTopLevelByComma(o);if(r.length<=1)return`${s}${o}${i}`;let a=s.match(/^(\s*)/),c=a?a[1]:"",l=c+" ".repeat(this.settings.indentSize),g=[];g.push(s.trimEnd());for(let u=0;u<r.length;u++){let m=this.normalizeFieldContent(r[u]),d=u===r.length-1?"":",";g.push(l+m+d)}return g.push(c+"}"),g.join(`
`)})}containsNonEmptyStructureBlock(e){let t=/(\w+)\s*::=\s*(SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{([\s\S]*?)\}/g,n;for(;(n=t.exec(e))!==null;)if(n[3].split(/\n/).map(o=>o.trim()).filter(o=>o.length>0&&o!=="{"&&o!=="}"&&!o.startsWith("--")).length>0)return!0;return!1}containsEmptyStructureBlock(e){let t=/(\w+)\s*::=\s*(SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{([\s\S]*?)\}/g,n;for(;(n=t.exec(e))!==null;)if(n[3].split(/\n/).map(o=>o.trim()).filter(o=>o.length>0&&o!=="{"&&o!=="}"&&!o.startsWith("--")).length===0)return!0;return!1}normalizeASN1Code(e){return e.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\t/g," ").split(`
`).map(o=>o.replace(/\s+/g," ").replace(/\s*{\s*/g," { ").replace(/\s*}\s*/g," } ").replace(/\s*,\s*/g,", ").replace(/\s*::=\s*/g," ::= ").trim()).join(`
`).trim()}parseASN1Structure(e){let t=e.split(`
`).map(s=>s.trim()).filter(s=>s.length>0),n={type:"root",name:"",content:"",children:[],level:0};return this.parseLines(t,n,0),n}parseLines(e,t,n){let s=n,o=0,i=e.length*10;for(;s<e.length&&o<i;){o++;let r=e[s];if(console.log(`\u{1F50D} Parsing line ${s}: "${r}"`),this.isModuleDefinition(r)){let c=this.createModuleNode(r);t.children.push(c),s++;continue}if(r.trim()==="BEGIN"||r.includes("BEGIN")){let c=this.createBeginNode();t.children.push(c),s++;continue}if(r.trim()==="END"||r.startsWith("END")){let c=this.createEndNode(r);t.children.push(c),s++;continue}if(this.isTypeDefinition(r)){let c=this.parseTypeDefinition(r,e,s);t.children.push(c.node),s=c.nextIndex;continue}if(this.isFieldDefinition(r)){let c=this.createFieldNode(r);t.children.push(c),s++;continue}if(this.isComment(r)){let c=this.createCommentNode(r);t.children.push(c),s++;continue}if(r==="}")break;let a=this.createOtherNode(r);t.children.push(a),s++}return o>=i&&console.warn("\u26A0\uFE0F Safety counter reached maximum iterations in parseLines, preventing infinite loop"),s}isSingleLineStructure(e){let t=[/^\w+\s*::=\s*(SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{[^{}]+\}\s*$/,/^\w+\s*::=\s*(SEQUENCE|SET)\s+OF\s+\w+\s*$/,/^\w+\s*::=\s*\w+\s*\([^)]*\)\s*$/];for(let n of t)if(n.test(e.trim()))return console.log("\u2705 Detected single line structure:",e),!0;return!1}createModuleNode(e){let t=e.match(/(\w+)\s+DEFINITIONS\s+(.*?)\s*::=\s*BEGIN/);return{type:"module",name:t?t[1]:"Unknown",content:e,children:[],level:0}}createBeginNode(){return{type:"begin",name:"BEGIN",content:"BEGIN",children:[],level:0}}createEndNode(e){return{type:"end",name:"END",content:e,children:[],level:0}}createFieldNode(e){let t=this.normalizeFieldContent(e),n=t.split(/\s+/);return{type:"field",name:n[0]||"",content:t,children:[],level:0}}createCommentNode(e){return{type:"comment",name:"comment",content:e,children:[],level:0}}createOtherNode(e){return{type:"other",name:"other",content:e,children:[],level:0}}parseTypeDefinition(e,t,n){console.log("\u{1F50D} Parsing type definition:",e);let s=e.match(/(\w+)\s*::=\s*(.+)/);if(!s)return{node:this.createOtherNode(e),nextIndex:n+1};let[,o,i]=s;if(this.isSingleLineStructure(e))return{node:this.parseSingleLineTypeDefinition(e,o,i),nextIndex:n+1};let r=i.match(/(SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{(.*)/);return r?this.parseMultiLineTypeDefinition(e,o,r[1],t,n):{node:{type:"type-definition",name:o,content:e,children:[],level:0,structureType:"PRIMITIVE"},nextIndex:n+1}}parseSingleLineTypeDefinition(e,t,n){let s=n.match(/(SEQUENCE|SET|CHOICE|ENUMERATED)\s*\{([^}]+)\}/);if(!s)return this.createOtherNode(e);let[,o,i]=s,r=this.parseInlineFields(i);return{type:"type-definition",name:t,content:e,children:[],level:0,structureType:o,isInline:!0,fields:r}}parseMultiLineTypeDefinition(e,t,n,s,o){let i={type:"type-definition",name:t,content:e,children:[],level:0,structureType:n,isInline:!1},r=1,a=o+1,c=0,l=s.length*5;for(;a<s.length&&r>0&&c<l;){c++;let g=s[a].trim();if(!g){a++;continue}let u=(g.match(/\{/g)||[]).length,m=(g.match(/\}/g)||[]).length;if(r+=u,r-=m,(r>0||r===0&&m>0)&&g!=="}"&&g!=="{"){let d=[];if(u>0&&m>0&&g.includes("{")&&g.includes("}")){let f=g.indexOf("{"),S=g.lastIndexOf("}"),E=f>=0&&S>f?g.substring(f+1,S):g;d=this.splitTopLevelByComma(E)}else d=this.splitTopLevelByComma(g);for(let f of d)if(f.trim().length>0){let S=this.createFieldNode(f);i.children.push(S)}}if(r===0&&m>0){a++;break}a++}return c>=l&&console.warn("\u26A0\uFE0F Safety counter reached maximum iterations in parseMultiLineTypeDefinition, preventing infinite loop"),{node:i,nextIndex:a}}parseInlineFields(e){let t=[],n="",s=0,o=0,i=!1,r=0,a=e.length*2;for(let c=0;c<e.length&&r<a;c++,r++){let l=e[c];if(l==='"'&&(c===0||e[c-1]!=="\\")&&(i=!i),!i){if(l==="{")s++;else if(l==="}")s--;else if(l==="(")o++;else if(l===")")o--;else if(l===","&&s===0&&o===0){n.trim()&&t.push(n.trim()),n="";continue}}n+=l}return n.trim()&&t.push(n.trim()),console.log("\u{1F4CB} Parsed inline fields:",t),t}formatASN1Structure(e){let t=[];return this.formatNode(e,t,0),this.cleanupFormattedLines(t).join(`
`)}formatNode(e,t,n){if(n>100){console.warn("\u26A0\uFE0F Maximum recursion depth reached in formatNode, preventing infinite recursion");return}let s=" ".repeat(n*this.settings.indentSize);switch(e.type){case"module":t.push(e.content);break;case"begin":t.push(s+e.content),t.push("");break;case"end":t.push(""),t.push(s+e.content);break;case"type-definition":if(e.isInline&&e.fields)this.formatInlineTypeDefinition(e,t,n);else{t.push(s+`${e.name} ::= ${e.structureType} {`);for(let o=0;o<e.children.length;o++){let i=e.children[o],r=" ".repeat((n+1)*this.settings.indentSize),a=this.splitTopLevelByComma(i.content);for(let c=0;c<a.length;c++){let l=this.normalizeFieldContent(a[c]),u=o===e.children.length-1&&c===a.length-1?"":",";t.push(r+l+u)}}t.push(s+"}")}t.push("");break;case"comment":t.push(s+e.content);break;default:t.push(s+e.content);break}if(e.type!=="type-definition")for(let o of e.children)this.formatNode(o,t,n+1)}formatInlineTypeDefinition(e,t,n){let s=" ".repeat(n*this.settings.indentSize),o=" ".repeat((n+1)*this.settings.indentSize);if(t.push(s+`${e.name} ::= ${e.structureType} {`),e.fields)for(let i=0;i<e.fields.length;i++){let r=this.normalizeFieldContent(e.fields[i]),c=i===e.fields.length-1?"":",";t.push(o+r+c)}t.push(s+"}"),t.push("")}cleanupFormattedLines(e){let t=[];for(let n=0;n<e.length;n++){let s=e[n],o=n>0?e[n-1]:null,i=n<e.length-1?e[n+1]:null;s===""&&o===""&&n>1&&e[n-2]===""||n===0&&s===""||n===e.length-1&&s===""&&o===""||t.push(s)}return t}fallbackFormat(e){console.log("\u{1F198} Using fallback formatting...");let t=e.split(`
`),n=[],s=0,o=" ".repeat(this.settings.indentSize);for(let i of t){let r=i.trim();!r||((r==="}"||r.startsWith("}"))&&(s=Math.max(0,s-1)),n.push(o.repeat(s)+r),r.includes("{")&&!r.includes("}")&&s++)}return n.join(`
`)}forceSplitFields(e){console.log("Force splitting fields:",e);let t=[],n="",s=0,o=0,i=0,r=!1;e=e.trim();let a=" ".repeat(this.settings.indentSize);for(let l=0;l<e.length;l++){let g=e[l],u=l>0?e[l-1]:"";if(g==='"'&&u!=="\\"&&(r=!r),!r){if(g==="{")s++;else if(g==="}")s--;else if(g==="(")o++;else if(g===")")o--;else if(g==="[")i++;else if(g==="]")i--;else if(g===","&&s===0&&o===0&&i===0){let m=n.trim();m&&t.push(a+m+","),n="";continue}}n+=g}let c=n.trim();return c&&t.push(a+c),console.log("Force split fields result:",t),t}forceSplitEnumValues(e){console.log("Force splitting enum values:",e);let t=[],n="",s=!1;e=e.trim();let o=" ".repeat(this.settings.indentSize);for(let r=0;r<e.length;r++){let a=e[r],c=r>0?e[r-1]:"";if(a==='"'&&c!=="\\"&&(s=!s),!s&&a===","&&!s){let l=n.trim();l&&t.push(o+l+","),n="";continue}n+=a}let i=n.trim();return i&&t.push(o+i),console.log("Force split enum values result:",t),t}wrapComment(e,t,n){let s=this.settings.maxLineLength-t*n,o="--",i=e.substring(2).trim();if(i.length<=s-o.length)return[this.indent(e,t,n)];let r=i.split(" "),a=[],c=o+" ";for(let l of r)(c+l).length<=s?c+=l+" ":(a.push(this.indent(c.trim(),t,n)),c=o+" "+l+" ");return c.trim()!==o&&a.push(this.indent(c.trim(),t,n)),a}preProcessLongLines(e){let t=e;console.log("Original input for preprocessing:",t),t=t.replace(/(\}\s*)(\w+\s*::=)/g,`$1
$2`),t=t.replace(/(BEGIN\s+)(\w+\s*::=)/g,`$1
$2`),t=t.replace(/(\}\s*)(END\b)/g,`$1
$2`);let n=/(\w+\s*::=\s*(?:SEQUENCE|SET|CHOICE)\s*\{)([^}]+)(\})/g;t=t.replace(n,(o,i,r,a)=>{console.log("Found single-line structure:",{prefix:i,fields:r,suffix:a});let c=this.forceSplitFields(r);return c.length>1?i+`
`+c.join(`
`)+`
`+a:o});let s=/(\w+\s*::=\s*ENUMERATED\s*\{)([^}]+)(\})/g;return t=t.replace(s,(o,i,r,a)=>{console.log("Found single-line enum:",{prefix:i,enumValues:r,suffix:a});let c=this.forceSplitEnumValues(r);return c.length>1?i+`
`+c.join(`
`)+`
`+a:o}),console.log("Preprocessed result:",t),t}formatTokens(e){let t=[],n=0,s=this.settings.indentSize;for(let o=0;o<e.length;o++){let i=e[o],r=e[o+1];switch(i.type){case"module-definition":t.push(i.content);break;case"begin":t.push(this.indent(i.content,n,s)),n++,t.push("");break;case"end":n=Math.max(0,n-1),t[t.length-1]!==""&&t.push(""),t.push(this.indent(i.content,n,s));break;case"type-name":t.push(this.indent(i.content,n,s));break;case"type-definition":t.push(this.indent(i.content,n,s)),n++;break;case"opening-brace":t.push(this.indent(i.content,n,s)),n++;break;case"field":t.push(this.indent(i.content,n,s));break;case"closing-brace":n=Math.max(0,n-1),t.push(this.indent(i.content,n,s)),r&&r.type!=="end"&&r.type!=="closing-brace"&&t.push("");break;case"comment":if(this.settings.autoWrapLongLines){let a=this.wrapComment(i.content,n,s);t.push(...a)}else t.push(this.indent(i.content,n,s));break;default:t.push(this.indent(i.content,n,s));break}}return t.filter((o,i)=>o===""?i===0||i===t.length-1||t[i-1]!=="":!0).join(`
`)}indent(e,t,n){return" ".repeat(t*n)+e}normalizeFieldContent(e){let t=(e!=null?e:"").trim();return t=t.replace(/,\s*$/,""),t=t.replace(/\s+/g," "),t}splitTopLevelByComma(e){let t=[],n="",s=0,o=0,i=0,r=!1;for(let a=0;a<e.length;a++){let c=e[a],l=a>0?e[a-1]:"";if(c==='"'&&l!=="\\"&&(r=!r),!r){if(c==="{")s++;else if(c==="}")s--;else if(c==="(")o++;else if(c===")")o--;else if(c==="[")i++;else if(c==="]")i--;else if(c===","&&s===0&&o===0&&i===0){t.push(this.normalizeFieldContent(n)),n="";continue}}n+=c}return n.trim().length>0&&t.push(this.normalizeFieldContent(n)),t}isModuleDefinition(e){return/^\w+\s+DEFINITIONS\s+.*::=\s+BEGIN$/.test(e)}isTypeDefinition(e){return/^\w+\s*::=/.test(e)}isFieldDefinition(e){return/^\w+\s+\w+/.test(e)&&!e.includes("::=")&&!e.includes("DEFINITIONS")}isComment(e){return e.startsWith("--")||e.startsWith("-*")&&e.endsWith("*-")}parseFieldList(e){let t=[],n=this.splitFields(e);for(let s of n)s.trim()&&t.push({type:"field",content:s,level:1});return t}splitFields(e){console.log("Splitting fields from:",e),e=e.replace(/^\s*\{\s*/,"").replace(/\s*\}\s*$/,"").trim();let t=[],n="",s=0,o=0,i=0,r=!1;for(let c=0;c<e.length;c++){let l=e[c],g=c>0?e[c-1]:"";if(l==='"'&&g!=="\\"&&(r=!r),!r){if(l==="{")s++;else if(l==="}")s--;else if(l==="(")o++;else if(l===")")o--;else if(l==="[")i++;else if(l==="]")i--;else if(l===","&&s===0&&o===0&&i===0){let u=n.trim();u&&t.push(u+","),n="";continue}}n+=l}let a=n.trim();return a&&t.push(a),console.log("Split fields result:",t),t}parseEnumValues(e){let t=[],n=this.splitEnumValues(e);for(let s of n)s.trim()&&t.push({type:"field",content:s,level:1});return t}splitEnumValues(e){let t=[],n="",s=0,o=0,i=e.length*2;for(let r=0;r<e.length&&o<i;r++,o++){let a=e[r];if(a==="(")s++;else if(a===")")s--;else if(a===","&&s===0){t.push(n.trim()+","),n="";continue}n+=a}return n.trim()&&t.push(n.trim()),console.log("Force split enum values result:",t),t}enhancedPostProcessing(e){let t=e;return t=t.replace(/::=/g," ::= "),t=t.replace(/\s+::=\s+/g," ::= "),t=t.replace(/,(\S)/g,", $1"),t=t.replace(/\{\s+/g,"{"),t=t.replace(/\s+\}/g,"}"),t=t.replace(/\s+OPTIONAL/g," OPTIONAL"),t=t.replace(/\s+DEFAULT/g," DEFAULT"),t=t.replace(/(\w+)\s*\((\d+)\)/g,"$1($2)"),t=t.replace(/\[\s*(\d+)\s*\]/g,"[$1]"),t=t.replace(/\[\s*(APPLICATION|UNIVERSAL|PRIVATE|CONTEXT)\s+(\d+)\s*\]/g,"[$1 $2]"),t=t.replace(/SEQUENCE\s+OF/g,"SEQUENCE OF"),t=t.replace(/SET\s+OF/g,"SET OF"),t=t.replace(/(\w)IMPLICIT/g,"$1 IMPLICIT"),t=t.replace(/(\w)EXPLICIT/g,"$1 EXPLICIT"),t=t.replace(/IMPLICIT(\w)/g,"IMPLICIT $1"),t=t.replace(/EXPLICIT(\w)/g,"EXPLICIT $1"),t=t.replace(/\{\s*\n\s*\n/g,`{
`),t=t.replace(/\}\s*\n\s*\n\s*(\w)/g,`}

$1`),t=t.replace(/(DEFINITIONS\s+.*::=\s+BEGIN)\n/g,`$1

`),t=t.replace(/\n(\s*)END\s*$/gm,`

$1END`),t}setupGlobalAutoFormatting(){console.log("Setting up global auto formatting..."),this.registerEvent(this.app.workspace.on("editor-change",e=>{this.handleEditorChange(e)})),console.log("Global auto formatting setup complete")}handleEditorChange(e){if(!!e&&!this.formattingInProgress){if(this.settings.formatOnSave){let t=e.getCursor();if(t&&this.isASN1CodeBlock(e)){let n=e.getLine(t.line);if(n&&t.ch>0){let s=n.charAt(t.ch-1);(s==="}"||s===";"||s===","||s===")"||s==="]")&&(console.log("Trigger character detected:",s),setTimeout(()=>{this.isASN1CodeBlock(e)&&this.autoFormatCurrentBlock(e)},200))}}}this.settings.autoFormatOnEnter&&setTimeout(()=>{if(!this.formattingInProgress&&this.isASN1CodeBlock(e)){let t=e.getCursor();t&&t.ch===0&&t.line>0&&(console.log("Detected potential Enter key press in ASN.1 block"),this.autoFormatCurrentBlock(e))}},100)}}async loadSettings(){this.settings=Object.assign({},y,await this.loadData()),this.applyCustomColors()}async saveSettings(){await this.saveData(this.settings)}},w=class extends p.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this,t=n=>({settingsTitle:"ASN.1 \u8BED\u6CD5\u8BBE\u7F6E",indentSize:"\u7F29\u8FDB\u5927\u5C0F",indentSizeDesc:"\u6BCF\u4E2A\u7F29\u8FDB\u7EA7\u522B\u4F7F\u7528\u7684\u7A7A\u683C\u6570",formatOnSave:"\u4FDD\u5B58\u65F6\u683C\u5F0F\u5316",formatOnSaveDesc:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801\u5757",maxLineLength:"\u6700\u5927\u884C\u957F\u5EA6",maxLineLengthDesc:"\u6362\u884C\u524D\u7684\u6700\u5927\u884C\u957F\u5EA6\uFF0840-120\u4E2A\u5B57\u7B26\uFF09",autoWrapLongLines:"\u81EA\u52A8\u6362\u884C\u957F\u884C",autoWrapLongLinesDesc:"\u683C\u5F0F\u5316\u65F6\u81EA\u52A8\u6362\u884C\u957F\u884C",autoFormatting:"\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnExit:"\u9000\u51FA\u65F6\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnExitDesc:"\u79BB\u5F00\u4EE3\u7801\u5757\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801",autoFormatOnEnter:"\u6309\u56DE\u8F66\u952E\u65F6\u81EA\u52A8\u683C\u5F0F\u5316",autoFormatOnEnterDesc:"\u5728\u4EE3\u7801\u5757\u4E2D\u6309\u56DE\u8F66\u952E\u65F6\u81EA\u52A8\u683C\u5F0F\u5316 ASN.1 \u4EE3\u7801",customKeywords:"\u81EA\u5B9A\u4E49\u5173\u952E\u5B57",customBasicTypes:"\u81EA\u5B9A\u4E49\u57FA\u672C\u7C7B\u578B",customBasicTypesDesc:'\u6DFB\u52A0\u7528\u4E8E\u8BED\u6CD5\u9AD8\u4EAE\u7684\u81EA\u5B9A\u4E49\u57FA\u672C\u7C7B\u578B\uFF08\u9017\u53F7\u5206\u9694\uFF0C\u4F8B\u5982 "MyType, CustomString, SpecialInt"\uFF09',colorSettings:"\u989C\u8272\u8BBE\u7F6E",lightThemeColors:"\u4EAE\u8272\u4E3B\u9898\u989C\u8272",darkThemeColors:"\u6697\u8272\u4E3B\u9898\u989C\u8272",resetColors:"\u91CD\u7F6E\u989C\u8272",resetColorsDesc:"\u5C06\u6240\u6709\u989C\u8272\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",resetToDefaults:"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C"})[n]||n;e.empty(),e.createEl("h2",{text:t("settingsTitle")}),new p.Setting(e).setName(t("indentSize")).setDesc(t("indentSizeDesc")).addSlider(n=>n.setLimits(1,8,1).setValue(this.plugin.settings.indentSize).setDynamicTooltip().onChange(async s=>{this.plugin.settings.indentSize=s,await this.plugin.saveSettings()})),new p.Setting(e).setName(t("formatOnSave")).setDesc(t("formatOnSaveDesc")).addToggle(n=>n.setValue(this.plugin.settings.formatOnSave).onChange(async s=>{this.plugin.settings.formatOnSave=s,await this.plugin.saveSettings()})),new p.Setting(e).setName(t("maxLineLength")).setDesc(t("maxLineLengthDesc")).addSlider(n=>n.setLimits(40,120,5).setValue(this.plugin.settings.maxLineLength).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxLineLength=s,await this.plugin.saveSettings()})),new p.Setting(e).setName(t("autoWrapLongLines")).setDesc(t("autoWrapLongLinesDesc")).addToggle(n=>n.setValue(this.plugin.settings.autoWrapLongLines).onChange(async s=>{this.plugin.settings.autoWrapLongLines=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:t("autoFormatting")}),new p.Setting(e).setName(t("autoFormatOnExit")).setDesc(t("autoFormatOnExitDesc")).addToggle(n=>n.setValue(this.plugin.settings.autoFormatOnExit).onChange(async s=>{this.plugin.settings.autoFormatOnExit=s,await this.plugin.saveSettings();let o=this.app.workspace.getActiveViewOfType("markdown");o&&o.editor&&this.plugin.setupAutoFormatting(o.editor)})),new p.Setting(e).setName(t("autoFormatOnEnter")).setDesc(t("autoFormatOnEnterDesc")).addToggle(n=>n.setValue(this.plugin.settings.autoFormatOnEnter).onChange(async s=>{this.plugin.settings.autoFormatOnEnter=s,await this.plugin.saveSettings();let o=this.app.workspace.getActiveViewOfType("markdown");o&&o.editor&&this.plugin.setupAutoFormatting(o.editor)})),e.createEl("h3",{text:t("customKeywords")}),new p.Setting(e).setName(t("customBasicTypes")).setDesc(t("customBasicTypesDesc")).addText(n=>n.setPlaceholder("MyType, CustomString, SpecialInt").setValue(this.plugin.settings.customKeywords).onChange(async s=>{this.plugin.settings.customKeywords=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:t("colorSettings")}),e.createEl("h4",{text:t("lightThemeColors")}),this.createColorSettings(e,"colors",t("lightThemeColors")),e.createEl("h4",{text:t("darkThemeColors")}),this.createColorSettings(e,"darkColors",t("darkThemeColors")),new p.Setting(e).setName(t("resetColors")).setDesc(t("resetColorsDesc")).addButton(n=>n.setButtonText(t("resetToDefaults")).setCta().onClick(async()=>{this.plugin.settings.colors={...y.colors},this.plugin.settings.darkColors={...y.darkColors},await this.plugin.saveSettings(),this.plugin.applyCustomColors(),this.display()}))}createColorSettings(e,t,n){let s=i=>({keywords:"\u5173\u952E\u5B57",strings:"\u5B57\u7B26\u4E32",comments:"\u6CE8\u91CA",numbers:"\u6570\u5B57",punctuation:"\u6807\u70B9\u7B26\u53F7",variables:"\u53D8\u91CF",objectIdentifiers:"\u5BF9\u8C61\u6807\u8BC6\u7B26",tags:"\u6807\u7B7E",operators:"\u64CD\u4F5C\u7B26",customKeywordsColor:"\u81EA\u5B9A\u4E49\u5173\u952E\u5B57"})[i]||i;[{key:"keyword",name:s("keywords"),desc:`${s("keywords")} (${n})`},{key:"string",name:s("strings"),desc:`${s("strings")} (${n})`},{key:"comment",name:s("comments"),desc:`${s("comments")} (${n})`},{key:"number",name:s("numbers"),desc:`${s("numbers")} (${n})`},{key:"punctuation",name:s("punctuation"),desc:`${s("punctuation")} (${n})`},{key:"variable",name:s("variables"),desc:`${s("variables")} (${n})`},{key:"oid",name:s("objectIdentifiers"),desc:`${s("objectIdentifiers")} (${n})`},{key:"tag",name:s("tags"),desc:`${s("tags")} (${n})`},{key:"operator",name:s("operators"),desc:`${s("operators")} (${n})`},{key:"customKeyword",name:s("customKeywordsColor"),desc:`${s("customKeywordsColor")} (${n})`}].forEach(i=>{new p.Setting(e).setName(i.name).setDesc(i.desc).addColorPicker(a=>a.setValue(this.plugin.settings[t][i.key]).onChange(async c=>{this.plugin.settings[t][i.key]=c,await this.plugin.saveSettings(),this.plugin.applyCustomColors()}))})}};
